/*! event-engine lib - v1.0.0 -2018-01-08 */
window.EventEngine=function(){function e(e){var t=this;if(this.eventRegistry={},this.socketOpen=!1,!e.url)throw"event stream url missing";this.eventStream=new ReconnectingWebSocket(e.url),this.eventStream.onopen=function(e){t.socketOpen=!0;for(var n in t.eventRegistry){var i=t.eventRegistry[n];t.addListener(i.query,i.callback,n)}},this.eventStream.onmessage=function(e){var n=e.data,i=JSON.parse(n);if("CALLBACK"===i.opCode){var r=t.eventRegistry[i.registryId];r&&r.callback(i.event)}},this.eventStream.onclose=function(e){t.socketOpen=!1},this.keepalive()}e.prototype.keepalive=function(){this.socketOpen&&this.eventStream.send(JSON.stringify({opCode:"PING"}));var e=this;setTimeout(function(){e.keepalive()},3e4)},e.prototype.addListener=function(e,t,n){if(!t)throw"callback function not provided";if(!e)throw"query not provided";return n||(n=Math.random().toString(36)),this.eventRegistry[n]={query:e,callback:t},this.socketOpen&&this.eventStream.send(JSON.stringify({opCode:"REGISTER_CALLBACK",query:e,registryId:n})),n},e.prototype.removeListener=function(e){this.socketOpen&&this.eventStream.send(JSON.stringify({opCode:"UNREGISTER_CALLBACK",registryId:e}))};return{get:function(t){return new e(t)}}}();